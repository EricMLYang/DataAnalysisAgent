# 異常洞察報告

**生成時間:** 2026-01-21 12:00  
**數據來源:** mock_data/{sales.csv, inventory.csv, anomaly_log.csv}  
**分析方法:** exploratory-data-analysis skill

---

## 執行摘要

使用 Agent Skills 對 mock_data 進行系統化分析，發現 **11 個已記錄的異常項目**，以及從 EDA 中額外識別的數據質量問題。關鍵發現包括極端異常值、負數邏輯錯誤、資料缺失和庫存管理問題。

---

## 1. Sales 數據異常洞察

### 📊 基本特徵
- **總記錄數:** 50 筆訂單
- **時間範圍:** 2026-01-01 至 2026-01-10
- **欄位數:** 6 (order_id, store_id, ts, product_id, quantity, sale_price)
- **資料缺失:** quantity (1筆), sale_price (1筆)

### 🚨 關鍵異常發現

#### A. 極端異常值 (Extreme Outliers)
從統計分佈看出嚴重偏態：

| 指標 | Quantity | Sale_Price |
|------|----------|------------|
| **平均值** | 388.31 | 2,166.56 |
| **中位數** | 3 | 120.00 |
| **標準差** | 1,890.71 | 14,268.58 |
| **最大值** | 9,999 | 99,999.99 |
| **最小值** | -5 | -999.99 |

**異常模式：**
- 平均值 >> 中位數（被極端值嚴重拉高）
- 標準差極大（數據波動異常）
- 存在負數訂單量與負數價格（邏輯錯誤）

#### B. 已識別的異常項目（來自 anomaly_log）
- **ORD-004:** quantity = 9,999（異常高銷量）
- **ORD-030:** quantity = -5（負數訂單）
- **ORD-046:** quantity = 8,888（異常高銷量）
- **ORD-032:** sale_price = -999.99（負數定價 - CRITICAL）
- **ORD-047:** sale_price = 99,999.99（異常高價 - CRITICAL）
- **ORD-018:** quantity = NULL（缺失值）
- **ORD-020:** sale_price = NULL（缺失值）

#### C. 數據質量評估
- ✅ **完整性:** 98% (49/50 完整記錄)
- ❌ **邏輯一致性:** 嚴重問題（負值、極端值）
- ❌ **分佈合理性:** 極度偏態，需清理

---

## 2. Inventory 數據異常洞察

### 📊 基本特徵
- **總記錄數:** 30 筆庫存快照
- **覆蓋範圍:** 3 個門市 × 10 個產品（理論值 30）
- **實際記錄:** 29-30（有缺失）
- **資料缺失:** on_hand (1筆), reserved (1筆)

### 🚨 關鍵異常發現

#### A. 負庫存問題 (CRITICAL)
```
on_hand 統計:
- 最小值: -20 (ST-02|PRD-E509)
- 平均值: 47.79
- 中位數: 48
```

**影響：**
- 庫存管理系統存在嚴重漏洞
- 可能導致超賣情況
- 需立即調查數據管道

#### B. 預留量邏輯錯誤 (HIGH)
```
reserved 統計:
- 最大值: 50 (ST-01|PRD-E509，但 on_hand = 15)
- 平均值: 14.14
- 中位數: 12
```

**異常：**
- **ST-01|PRD-E509:** reserved (50) > on_hand (15)
  - 違反業務邏輯：預留不可超過現有庫存
  - 建議：檢查訂單系統與庫存系統的同步機制

#### C. 數據質量評估
- ✅ **完整性:** 96.7% (58/60 完整值)
- ❌ **邏輯一致性:** 2 個嚴重邏輯錯誤
- ⚠️ **業務規則違反:** reserved > on_hand

---

## 3. Anomaly Log 元分析

### 📊 基本特徵
- **總異常記錄:** 11 筆
- **影響表:** sales (7筆), inventory (4筆)
- **檢測時間:** 2026-01-15 10:30-10:36

### 🎯 異常類型分佈

| 異常類型 | 數量 | 嚴重度分佈 |
|---------|------|-----------|
| **LOGIC_ERROR** | 4 | CRITICAL (2), HIGH (2) |
| **OUTLIER** | 3 | CRITICAL (1), HIGH (2) |
| **MISSING_VALUE** | 4 | MEDIUM (3), LOW (1) |

### 🔍 嚴重度層級分析

#### CRITICAL (3 筆) - 需立即處理
1. **sales.sale_price = -999.99** → 數據損壞
2. **sales.sale_price = 99999.99** → 定價異常
3. **inventory.on_hand = -20** → 負庫存

#### HIGH (4 筆) - 需優先驗證
1. **sales.quantity = 9999** → 可能的大宗訂單
2. **sales.quantity = -5** → 數據管道錯誤
3. **sales.quantity = 8888** → 可能的大宗訂單
4. **inventory.reserved > on_hand** → 邏輯衝突

#### MEDIUM/LOW (4 筆) - 需補充資料
- 3 筆 NULL 值需從來源系統補正
- 1 筆低優先級的 reservation 缺失

---

## 4. 跨表關聯異常模式

### A. PRD-E509 產品的系統性問題
該產品在兩個表中都出現異常：

| 表 | 門市 | 異常描述 | 嚴重度 |
|----|------|---------|--------|
| inventory | ST-01 | reserved (50) > on_hand (15) | HIGH |
| inventory | ST-02 | on_hand = -20 | CRITICAL |

**推測：**
- 可能是熱銷商品導致庫存管理失控
- 建議檢查該產品的訂單履行流程

### B. 極端值聚集現象
- **ORD-004 & ORD-046:** 兩筆 > 8000 的超高訂單量
- **ORD-032 & ORD-047:** 兩筆價格異常（一負一極高）
- **可能原因:** 
  - 測試數據未清理
  - 數據輸入錯誤
  - 系統整合問題

---

## 5. 建議的修復行動

### 🚨 立即處理 (0-24 小時)
1. **修正負庫存 (ST-02|PRD-E509)**
   - 執行庫存盤點
   - 回溯交易記錄找出原因
   
2. **處理異常定價 (ORD-032, ORD-047)**
   - 驗證是否為數據損壞
   - 若為真實交易，需調查定價系統

3. **補正缺失值**
   - 從來源系統重新抓取 ORD-018, ORD-020 的完整數據

### ⚠️ 短期處理 (1-7 天)
1. **驗證大宗訂單 (ORD-004, ORD-046)**
   - 確認是否為合法的 B2B 交易
   - 若為錯誤，需調整數據

2. **修正 reserved > on_hand 邏輯**
   - 實施業務規則驗證
   - 加入資料庫約束條件

### 📊 長期改善 (持續)
1. **建立數據質量監控**
   - 設定異常值告警閾值
   - 定期執行數據質量檢查

2. **強化輸入驗證**
   - 在應用層加入數值範圍檢查
   - 實施邏輯一致性驗證

3. **改善庫存系統**
   - 檢視訂單系統與庫存系統的整合點
   - 實施實時庫存同步機制

---

## 6. 技術實施建議

### 數據清理流程
```python
# 建議的數據清理步驟（概念性）
1. 移除/修正負數值
2. 處理極端異常值 (使用 IQR 方法)
3. 補正缺失值
4. 驗證業務邏輯規則
5. 重新生成乾淨的數據集
```

### 監控指標
- **數據新鮮度:** 最後更新時間追蹤
- **完整性比例:** 缺失值百分比
- **邏輯一致性:** 業務規則違反次數
- **異常值比例:** 超出合理範圍的記錄百分比

---

## 7. 結論

本次使用 **exploratory-data-analysis skill** 對 mock_data 進行系統化分析，成功識別出：

✅ **已記錄異常:** 11 個（來自 anomaly_log）  
✅ **EDA 發現:** 負值、極端偏態分佈、邏輯衝突  
✅ **跨表關聯:** PRD-E509 的系統性問題  
✅ **數據質量:** 整體完整性 > 96%，但存在嚴重的邏輯一致性問題

**關鍵洞察：**
- 數據質量問題主要集中在 **邏輯一致性** 而非完整性
- **PRD-E509** 需要特別關注，跨兩表都有異常
- 建議優先處理 3 個 CRITICAL 級別異常，以防止業務影響擴大

---

*本報告由 exploratory-data-analysis skill 生成，完整 EDA 報告請見：*
- [sales_eda.md](./sales_eda.md)
- [inventory_eda.md](./inventory_eda.md)
- [anomaly_log_eda.md](./anomaly_log_eda.md)
